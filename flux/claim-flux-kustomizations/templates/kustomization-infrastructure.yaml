---
apiVersion: resources.stuttgart-things.com/v1alpha1
kind: ClaimTemplate
metadata:
  name: kustomization-infrastructure
  title: Flux Kustomization Infrastructure
  description: Deploys a Flux Kustomization for infrastructure with wait, health checks, and dependencies
  tags:
    - flux
    - kustomization
    - infrastructure
spec:
  type: kustomization
  source: oci://ghcr.io/stuttgart-things/claim-flux-kustomizations
  tag: 0.1.0
  parameters:
    - name: templateName
      title: Template
      type: string
      default: infrastructure

    - name: name
      title: Resource Name
      type: string
      required: true
      pattern: "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$"

    - name: namespace
      title: Namespace
      type: string
      default: flux-system
      pattern: "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$"

    - name: sourceRefKind
      title: Source Reference Kind
      type: string
      default: GitRepository
      enum:
        - GitRepository
        - OCIRepository
        - Bucket

    - name: sourceRefName
      title: Source Reference Name
      type: string
      required: true
      pattern: "^[a-z0-9]([-a-z0-9]*[a-z0-9])?$"

    - name: sourceRefNamespace
      title: Source Reference Namespace
      type: string
      description: "Namespace of the source, defaults to Kustomization namespace"

    - name: path
      title: Path
      type: string
      default: "./"
      description: "Path to the directory containing the kustomization.yaml"

    - name: interval
      title: Reconciliation Interval
      type: string
      default: "10m"
      description: "Interval at which to reconcile (e.g., 5m, 1h)"

    - name: retryInterval
      title: Retry Interval
      type: string
      default: "2m"
      description: "Interval at which to retry failed reconciliations"

    - name: timeout
      title: Timeout
      type: string
      default: "5m"
      description: "Timeout for apply and health checking"

    - name: prune
      title: Enable Pruning
      type: boolean
      default: true
      description: "Enable garbage collection of resources"

    - name: force
      title: Force Recreation
      type: boolean
      default: false
      description: "Recreate resources when patching fails"

    - name: suspend
      title: Suspend Reconciliation
      type: boolean
      default: false

    - name: targetNamespace
      title: Target Namespace
      type: string
      description: "Override namespace for all resources"

    - name: namePrefix
      title: Name Prefix
      type: string
      description: "Prefix for all resource names"

    - name: nameSuffix
      title: Name Suffix
      type: string
      description: "Suffix for all resource names"

    - name: dependsOnNames
      title: Dependency Names
      type: string
      description: "Comma-separated list of Kustomization names this depends on"

    - name: dependsOnNamespace
      title: Dependencies Namespace
      type: string
      description: "Namespace of dependencies, defaults to Kustomization namespace"

    - name: substitute
      title: Post-Build Substitutions
      type: string
      description: "Comma-separated key=value pairs for variable substitution"

    - name: decryptionProvider
      title: Decryption Provider
      type: string
      enum:
        - sops
      description: "Enable SOPS decryption"

    - name: decryptionSecretRef
      title: Decryption Secret
      type: string
      description: "Secret containing decryption keys"

    - name: kubeConfigSecretRef
      title: KubeConfig Secret
      type: string
      description: "Secret containing kubeconfig for remote cluster deployment"

    - name: kubeConfigSecretKey
      title: KubeConfig Secret Key
      type: string
      default: "value"
      description: "Key in the kubeconfig secret"

    - name: serviceAccountName
      title: Service Account
      type: string
      description: "Service account to impersonate during reconciliation"

    - name: commonLabels
      title: Common Labels
      type: string
      description: "Comma-separated key=value pairs for labels on all resources"

    - name: commonAnnotations
      title: Common Annotations
      type: string
      description: "Comma-separated key=value pairs for annotations on all resources"
