---
apiVersion: apiextensions.crossplane.io/v1
kind: CompositeResourceDefinition
metadata:
  name: xvaultk8sauths.vault.crossplane.io
spec:
  group: vault.crossplane.io
  names:
    kind: XVaultK8sAuth
    plural: xvaultk8sauths
  claimNames:
    kind: VaultK8sAuth
    plural: vaultk8sauths
  versions:
  - name: v1alpha1
    served: true
    referenceable: true
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            properties:
              clusterName:
                type: string
                description: "Kubernetes cluster name for Vault auth backend"
                default: "default"
              vaultAddr:
                type: string
                description: "Vault server address (e.g., https://vault.example.com)"
              vaultTokenSecret:
                type: string
                description: "Name of the secret containing Vault token"
                default: "vault"
              vaultTokenSecretNamespace:
                type: string
                description: "Namespace of the Vault token secret"
                default: "crossplane-system"
              vaultTokenSecretKey:
                type: string
                description: "Key in the secret containing terraform.tfvars with Vault token"
                default: "terraform.tfvars"
              k8sAuths:
                type: array
                description: "List of Kubernetes auth backends to create"
                items:
                  type: object
                  required:
                  - name
                  properties:
                    name:
                      type: string
                      description: "Name of the auth backend and service account"
                    clusterName:
                      type: string
                      description: "Override cluster name for this auth backend"
                    vaultAddr:
                      type: string
                      description: "Override Vault address for this auth backend"
                    skipTlsVerify:
                      type: boolean
                      description: "Skip TLS verification for Vault"
                      default: false
                    tokenPolicies:
                      type: array
                      description: "List of Vault policies to attach to tokens"
                      items:
                        type: string
                      default: []
                    tokenTtl:
                      type: integer
                      description: "Token TTL in seconds"
                      default: 3600
                    boundServiceAccountNamespaces:
                      type: array
                      description: "Namespaces allowed to authenticate"
                      items:
                        type: string
                      default:
                      - "default"
            required:
            - clusterName
            - vaultAddr
            - k8sAuths
          status:
            type: object
            properties:
              authBackends:
                type: array
                description: "Status of created auth backends"
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    path:
                      type: string
                    ready:
                      type: boolean